[{"name": "Auto GPS","description": "by诗里沧海怨怼 | 自动开关GPS | 千万不要改priority","priority": 1,"condition": "frontActivityChanged||pkgKilled","actions": ["cntGPS=0;if(pkgKilled){if(hw.isLocationEnabled()){fp=thanos.profileManager.getLogPath();fp=fp.substring(0,fp.length()-38);path=java.nio.file.Paths.get(fp,'profile_user_io/starlee/AutoGPS');if(java.nio.file.Files.exists(path)){str=io.read('starlee/AutoGPS');strs=str.split(' ');diff=System.currentTimeMillis()-Long.valueOf(strs[0]);if(diff<50&&pkgName==strs[1]){return;}if(diff<150){cntGPS=Integer.valueOf(strs[2]);}}notGPS=true;for(app:globalVarOf$GPSApp){if(++cntGPS==50){Thread.sleep(150);cntGPS=0;}if(app!=null&&app.charAt(app.length()-1)=='#'&&app.startsWith(pkgName)){notGPS=false;}}if(notGPS){io.write('starlee/AutoGPS',System.currentTimeMillis()+' '+pkgName+' '+cntGPS);return;}curActivity=thanos.activityManager.getTopVisibleActivities().get(0).name;fStr=curActivity.flattenToString();curPkg=curActivity.getPackageName();cntGPS=0;for(app:globalVarOf$GPSApp){if(++cntGPS==50){Thread.sleep(150);cntGPS=0;}if(app!=null){if(app.startsWith(curPkg)){if(app.charAt(app.length()-1)!='-'||globalVarOf$GPSUI.contains(fStr)){io.write('starlee/AutoGPS',System.currentTimeMillis()+' '+pkgName+' '+cntGPS);return;}}else if(app.charAt(app.length()-1)=='#'&&thanos.activityManager.isPackageRunning(app.split(' ')[0])){io.write('starlee/AutoGPS',System.currentTimeMillis()+' '+pkgName+' '+cntGPS);return;}}}hw.disableLocation();ui.showShortToast('关闭GPS');io.write('starlee/AutoGPS',System.currentTimeMillis()+' '+pkgName+' '+cntGPS);}}else{fromApp=fromActivity.getPackageName();fromStr=fromActivity.flattenToString();toApp=toActivity.getPackageName();toStr=toActivity.flattenToString();selectedFrom=null;selectedTo=null;for(app:globalVarOf$GPSApp){if(++cntGPS==50){Thread.sleep(150);cntGPS=0;}if(app!=null){if(selectedFrom==null&&app.startsWith(fromApp)){selectedFrom=app;selectedTo=(fromApp==toApp)?selectedFrom:selectedTo;}else if(selectedTo==null&&app.startsWith(toApp)){selectedTo=app;}}}if(selectedFrom==null){if(selectedTo==null){return;}if(selectedTo.charAt(selectedTo.length()-1)!='-'||globalVarOf$GPSUI.contains(toStr)){if(!hw.isLocationEnabled()){hw.enableLocation();ui.showShortToast('开启GPS');}return;}}else{if(selectedTo!=null){if(selectedTo.charAt(selectedTo.length()-1)!='-'||globalVarOf$GPSUI.contains(toStr)){if(!hw.isLocationEnabled()){hw.enableLocation();ui.showShortToast('开启GPS');}return;}}cntGPS=0;for(app:globalVarOf$GPSApp){if(++cntGPS==50){Thread.sleep(150);cntGPS=0;}if(app!=null&&app.charAt(app.length()-1)=='#'&&thanos.activityManager.isPackageRunning(app.split(' ')[0])){return;}}if(hw.isLocationEnabled()){hw.disableLocation();ui.showShortToast('关闭GPS');}}}"]}]
